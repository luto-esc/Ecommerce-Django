{% extends 'base.html' %}

{% block content %}

<div class="product-detail">
    <div class="product-detail-main">
        <!-- Carrusel de im谩genes (izquierda) -->
        <div class="carousel">
            <button class="carousel-btn carousel-prev" onclick="moveCarousel(-1)">&#10094;</button>
            <div class="carousel-container">
                {% for images in product.images.all %}
                <div class="carousel-slide {% if forloop.first %}active{% endif %}">
                    <img src="{{ images.images.url }}" alt="{{ product.name }}">
                </div>
                {% empty %}
                <div class="carousel-slide active">
                    <div class="no-image">Sin imagen</div>
                </div>
                {% endfor %}
            </div>
            <button class="carousel-btn carousel-next" onclick="moveCarousel(1)">&#10095;</button>
        </div>

        <!-- Informaci贸n del producto (derecha) -->
        <div class="product-info">
            <h2 class="product-title">{{ product.name }}</h2>
            <p class="product-price">${{ product.price }}</p>
            <p class="product-cost">Costo: ${{ product.cost_price }}</p>
            <p class="product-stock">Stock disponible: {{ product.stock }} unidades</p>
            <a href="{% url 'products:path_products_list_byuser' product.user_author.username %}">Ver mas productos de {{product.user_author.username}}</a>
            <!-- Reacciones integradas -->
            <div class="product-reactions">
                <span class="like-count"> {{ product.myLikes }}</span>
                <span class="dislike-count"> {{ product.myDislikes }}</span>
                <form method="POST" action="{% url 'reactions:path_product_reaction' product.pk %}"
                    class="reaction-form">
                    {% csrf_token %}
                    <button type="submit" name="action" value="like" class="btn-small btn-like">Like</button>
                    <button type="submit" name="action" value="dislike" class="btn-small btn-dislike">Dislike</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Descripci贸n del producto -->
    <div class="product-description-section">
        <h3>Descripci贸n</h3>
        <p>{{ product.description }}</p>
    </div>

    <!-- Secci贸n de opiniones -->
    <div class="opinions-section">
        <h3>Opiniones</h3>

        {% for o in product.myOpinions %}
        <div class="opinion">
            <div class="opinion-header">
                <span class="author">{{ o.author }}</span>
                <span class="date">{{ o.create_data }}</span>
            </div>
            <p class="text">{{ o.text }}</p>
            <div class="opinion-reactions">
                <span class="like-count"> {{ o.myLikes }}</span>
                <span class="dislike-count"> {{ o.myDislikes }}</span>
            </div>
            <div class="opinion-actions">
                <form method="POST" action="{% url 'reactions:path_opinion_reaction' o.pk %}" class="reaction-form">
                    {% csrf_token %}
                    <button type="submit" name="action" value="like" class="btn-small btn-like">Like</button>
                    <button type="submit" name="action" value="dislike" class="btn-small btn-dislike">Dislike</button>
                </form>
                <a href="{% url 'opinions:path_opinion_delete' o.pk %}" class="btn-small btn-delete">Eliminar</a>
            </div>
        </div>
        {% empty %}
        <p class="no-opinions">Todav铆a no hay opiniones sobre este producto.</p>
        {% endfor %}

        <!-- Formulario para dejar opini贸n -->
        <div class="opinion-form">
            <h4>Deja tu opini贸n</h4>
            <form method="POST" action="{% url 'opinions:path_opinion_create' product.pk %}">
                {% csrf_token %}
                <textarea name="text_comment" placeholder="Escribe tu opini贸n aqu铆..."></textarea>
                <button type="submit">Comentar</button>
            </form>
        </div>
    </div>
</div>

<script>
    let currentSlide = 0;

    function moveCarousel(direction) {
        const slides = document.querySelectorAll('.carousel-slide');
        if (slides.length === 0) return;

        slides[currentSlide].classList.remove('active');
        currentSlide = (currentSlide + direction + slides.length) % slides.length;
        slides[currentSlide].classList.add('active');
    }
</script>

{% endblock content %}